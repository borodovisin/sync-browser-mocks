!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("syncBrowserMocks",[],t):"object"==typeof exports?exports.syncBrowserMocks=t():e.syncBrowserMocks=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(){(0,o.patchPostMessage)(),(0,i.patchPromise)(),(0,s.patchSetTimeout)(),(0,s.patchSetInterval)(),(0,c.patchXmlHttpRequest)()}Object.defineProperty(t,"__esModule",{value:!0}),t.patchAll=r;var o=n(1);Object.keys(o).forEach(function(e){"default"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var i=n(2);Object.keys(i).forEach(function(e){"default"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var s=n(3);Object.keys(s).forEach(function(e){"default"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var c=n(4);Object.keys(c).forEach(function(e){"default"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})})},function(e,t){"use strict";function n(){}Object.defineProperty(t,"__esModule",{value:!0}),t.patchPostMessage=n},function(e,t){"use strict";function n(e,t,n){function r(){if(s){if(u)return n(o);if(c)return t(i)}}var o,i,s=!1,c=!1,u=!1;try{e(function(e){i=e,c=!0,r()},function(e){o=e,u=!0,r()})}catch(a){return n(a)}s=!0,r()}function r(e){e.resolved||e.hasErrorHandlers||(u.push(e),c=c||setTimeout(o,1))}function o(){c=null;var e=u;u=[];for(var t=0;t<e.length;t++){var n=e[t];n.hasErrorHandlers||(n.handlers.push({onError:i}),n.dispatch())}}function i(e){e=e.stack||e.toString(),window.console&&window.console.error?window.console.error(e):window.console&&window.console.log&&window.console.log(e)}function s(){window.Promise=a}Object.defineProperty(t,"__esModule",{value:!0}),t.patchPromise=s;var c,u=[],a=t.SyncPromise=function(e){if(this.resolved=!1,this.rejected=!1,this.hasErrorHandlers=!1,this.hasSuccessHandlers=!1,this.handlers=[],r(this),e){var t=this;n(e,function(e){return t.resolve(e)},function(e){return t.reject(e)})}};a.resolve=function(e){return e&&e.then?e:(new a).resolve(e)},a.reject=function(e){return(new a).reject(e)},a.prototype.resolve=function(e){if(this.resolved||this.rejected)return this;if(e&&e.then)throw new Error("Can not resolve promise with another promise");return this.resolved=!0,this.value=e,this.dispatch(),this},a.prototype.reject=function(e){if(this.resolved||this.rejected)return this;if(e&&e.then)throw new Error("Can not reject promise with another promise");return this.rejected=!0,this.value=e,this.dispatch(),this},a.prototype.dispatch=function(){var e=this;if(this.resolved||this.rejected)for(var t=function(){var t=e.handlers.shift();try{e.resolved?n=t.onSuccess?t.onSuccess(e.value):e.value:t.onError?n=t.onError(e.value):r=e.value}catch(o){r=o}if(n===e)throw new Error("Can not return a promise from the the then handler of the same promise");return t.promise?void(r?t.promise.reject(r):n&&n.then?n.then(function(e){t.promise.resolve(e)},function(e){t.promise.reject(e)}):t.promise.resolve(n)):"continue"};this.handlers.length;){var n,r;t()}},a.prototype.then=function(e,t){var n=new a;return e&&(this.hasSuccessHandlers=!0),t&&(this.hasErrorHandlers=!0),this.handlers.push({promise:n,onSuccess:e,onError:t}),this.dispatch(),n},a.prototype["catch"]=function(e){return this.then(null,e)},a.prototype["finally"]=function(e){return this.then(function(t){return e(),t},function(t){throw e(),t})},a.all=function(e){for(var t=new a,n=e.length,r=[],o=0;o<e.length;o++)e[o].then(function(e){r[o]=e,n-=1,0===n&&t.resolve(r)},function(e){t.reject(e)});return t}},function(e,t){"use strict";function n(e,t){if(e)for(var n=0;n<e.length;n++)if(t(e[n]))return n}function r(e,t){t=t||0;var n=h(function(){a.splice(a.indexOf(r),1),e()},t),r={id:n,time:t,method:e,count:d++};return a.push(r),n}function o(e){if(void 0!==e){l(e);var t=n(a,function(t){return t.id===e});a.splice(t,1)}}function i(e,t){var n=m(e,t),r={id:n,time:t,method:e,count:y++};return v.push(r),n}function s(e){if(void 0!==e){w(e);var t=n(v,function(t){return t.id===e});v.splice(t,1)}}function c(){window.setTimeout=r,window.clearTimeout=o}function u(){window.setInterval=i,window.clearInterval=s}Object.defineProperty(t,"__esModule",{value:!0}),t.syncSetTimeout=r,t.syncClearTimeout=o,t.syncSetInterval=i,t.syncClearInterval=s,t.patchSetTimeout=c,t.patchSetInterval=u;var a=[],h=window.setTimeout,l=window.clearTimeout,d=0,f=-1,p=1;r.flush=function(){for(;a.length;){a.sort(function(e,t){return e.time===t.time?e.count<t.count?f:p:e.time<t.time?f:p});var e=a.shift();e.method(),clearInterval(e.id)}};var v=[],m=window.setInterval,w=window.clearInterval,y=0;i.cycle=function(){for(var e=v.length,t=0;e>t;t++){var n=v[t];n.method(),w(n.id),setInterval(n.method,n.time)}}},function(e,t){"use strict";function n(e){e.method=e.method||"GET","string"==typeof e.uri&&(e.uri=e.uri.replace(/\?/g,"\\?")),this.status=e.status||200,this.rawMethod=e.method.toString(),this.rawUri=e.uri.toString(),this.method=e.method instanceof RegExp?e.method:new RegExp(e.method,"i"),this.uri=e.uri instanceof RegExp?e.uri:new RegExp(e.uri,"i"),this.handler=e.handler,this.data=e.data,i.unshift(this)}function r(){}function o(){window.XMLHttpRequest=r}Object.defineProperty(t,"__esModule",{value:!0}),t.$mockEndpoint=n,t.SyncXMLHttpRequest=r,t.patchXmlHttpRequest=o;var i=[];n.prototype={enabled:!1,expect:!1,called:!1,listen:function(){return this.listening=!0,this.enable(),this},enable:function(){return this.enabled=!0,this},disable:function(){return this.enabled=!1,this.expect=!1,this},match:function(e,t){return Boolean(this.method.test(e)&&this.uri.test(t))},call:function(e,t){return this.called=!0,this.handler?this.handler(e,t):this.data},expectCalls:function(){return i.splice(i.indexOf(this),1),i.unshift(this),this.expect=!0,this.called=!1,this.enable(),this},done:function(){var e=this.expect&&!this.called;if(this.listening||this.disable(),this.expect=!1,this.called=!1,e)throw new Error("Expected call to "+this.rawMethod+" "+this.rawUri)}},n.register=function(e){return new n(e)},n.find=function(e,t){var n;return i.some(function(r){return r.match(e,t)&&r.enabled?n=r:void 0}),n},r.prototype={listen:function(){},open:function(e,t){var r=this;this.method=e,this.uri=t,this.mock=n.find(e,t),this.params={};var o=t.indexOf("?")>=0?t.substr(t.indexOf("?")+1).split("&"):[];if(o.forEach(function(e){var t=e.split("=");r.params[decodeURIComponent(t[0])]=decodeURIComponent(t[1])}),!this.mock)throw new Error("Unexpected "+e.toUpperCase()+" "+t)},setRequestHeader:function(){},getResponseHeader:function(){},getAllResponseHeaders:function(){return"Content-Type: application/json"},send:function(e){var t=this;e&&(e=JSON.parse(e)),console.debug("REQUEST",this.method,this.uri,e);var n=this.mock.call(e,this.params);this._respond(this.mock.status,n);var r=void 0,o={get:function(){return r},set:function(e){r=e,t._respond(t.mock.status,n)}};Object.defineProperty(this,"onreadystatechange",o),Object.defineProperty(this,"onload",o)},_respond:function(e,t){if(!this._responded){var n=this.onreadystatechange||this.onload;n&&(this._responded=!0,console.debug("RESPONSE",e,JSON.stringify(t,0,2)),this.status=e,this.response=this.responseText=JSON.stringify(t),this.readyState=4,n.call(this))}}}}])});