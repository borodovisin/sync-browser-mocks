!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("syncBrowserMocks",[],e):"object"==typeof exports?exports.syncBrowserMocks=e():t.syncBrowserMocks=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(){(0,i.patchPostMessage)(),(0,o.patchPromise)(),(0,s.patchSetTimeout)(),(0,s.patchSetInterval)(),(0,c.patchXmlHttpRequest)()}Object.defineProperty(e,"__esModule",{value:!0}),e.patchAll=r;var i=n(1);Object.keys(i).forEach(function(t){"default"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return i[t]}})});var o=n(2);Object.keys(o).forEach(function(t){"default"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return o[t]}})});var s=n(3);Object.keys(s).forEach(function(t){"default"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return s[t]}})});var c=n(4);Object.keys(c).forEach(function(t){"default"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return c[t]}})})},function(t,e){"use strict";function n(){}Object.defineProperty(e,"__esModule",{value:!0}),e.patchPostMessage=n},function(t,e){"use strict";function n(t,e,n){function r(){if(i){if(s)return n(c);if(o)return e(u)}}var i=!1,o=!1,s=!1,c=void 0,u=void 0;try{t(function(t){u=t,o=!0,r()},function(t){c=t,s=!0,r()})}catch(a){return n(a)}i=!0,r()}function r(t){a.push(t),h=h||setTimeout(i,1)}function i(){h=null;var t=a;a=[];for(var e=function(e){var n=t[e];return n.silentReject?"continue":(n.handlers.push({onError:function(t){n.silentReject||o(t)}}),void n.dispatch())},n=0;n<t.length;n++){e(n)}}function o(t){if(-1===f.indexOf(t)){f.push(t),setTimeout(function(){throw t},1);for(var e=0;e<u.length;e++)u[e](t)}}function s(t){try{if(!t)return!1;if(window.Window&&t instanceof window.Window)return!1;if(window.constructor&&t instanceof window.constructor)return!1;if(l){var e=l.call(t);if("[object Window]"===e||"[object global]"===e||"[object DOMWindow]"===e)return!1}if(t&&t.then instanceof Function)return!0}catch(n){return!1}return!1}function c(){window.Promise=d}Object.defineProperty(e,"__esModule",{value:!0}),e.patchPromise=c;var u=[],a=[],h=void 0,f=[],l={}.toString,d=e.SyncPromise=function(t){if(this.resolved=!1,this.rejected=!1,this.silentReject=!1,this.handlers=[],r(this),t){var e=this;n(t,function(t){return e.resolve(t)},function(t){return e.reject(t)})}};d.resolve=function(t){return s(t)?t:(new d).resolve(t)},d.reject=function(t){return(new d).reject(t)},d.prototype.resolve=function(t){if(this.resolved||this.rejected)return this;if(s(t))throw new Error("Can not resolve promise with another promise");return this.resolved=!0,this.value=t,this.dispatch(),this},d.prototype.reject=function(t){if(this.resolved||this.rejected)return this;if(s(t))throw new Error("Can not reject promise with another promise");return this.rejected=!0,this.value=t,this.dispatch(),this},d.prototype.asyncReject=function(t){this.silentReject=!0,this.reject(t)},d.prototype.dispatch=function(){var t=this;if(this.resolved||this.rejected)for(var e=function(){var e=t.handlers.shift(),n=void 0,r=void 0;try{t.resolved?n=e.onSuccess?e.onSuccess(t.value):t.value:t.rejected&&(e.onError?n=e.onError(t.value):r=t.value)}catch(i){r=i}if(n===t)throw new Error("Can not return a promise from the the then handler of the same promise");return e.promise?void(r?e.promise.reject(r):s(n)?n.then(function(t){e.promise.resolve(t)},function(t){e.promise.reject(t)}):e.promise.resolve(n)):"continue"};this.handlers.length;){e()}},d.prototype.then=function(t,e){if(t&&"function"!=typeof t&&!t.call)throw new Error("Promise.then expected a function for success handler");if(e&&"function"!=typeof e&&!e.call)throw new Error("Promise.then expected a function for error handler");var n=new d(null,this);return this.handlers.push({promise:n,onSuccess:t,onError:e}),this.silentReject=!0,this.dispatch(),n},d.prototype["catch"]=function(t){return this.then(null,t)},d.prototype["finally"]=function(t){return this.then(function(e){return d["try"](t).then(function(){return e})},function(e){return d["try"](t).then(function(){throw e})})},d.all=function(t){for(var e=new d,n=t.length,r=[],i=function(i){var o=s(t[i])?t[i]:d.resolve(t[i]);o.then(function(t){r[i]=t,n-=1,0===n&&e.resolve(r)},function(t){e.reject(t)})},o=0;o<t.length;o++)i(o);return n||e.resolve(r),e},d.onPossiblyUnhandledException=function(t){u.push(t)},d["try"]=function(t){return d.resolve().then(t)},d.delay=function(t){return new d(function(e){setTimeout(e,t)})},d.hash=function(t){var e={},n=[],r=function(r){t.hasOwnProperty(r)&&n.push(d.resolve(t[r]).then(function(t){e[r]=t}))};for(var i in t)r(i);return d.all(n).then(function(){return e})}},function(t,e){"use strict";function n(t,e){if(t)for(var n=0;n<t.length;n++)if(e(t[n]))return n}function r(t,e){e=e||0;var n=h(function(){a.splice(a.indexOf(r),1),t()},e),r={id:n,time:e,method:t,count:l++};return a.push(r),n}function i(t){if(void 0!==t){f(t);var e=n(a,function(e){return e.id===t});a.splice(e,1)}}function o(t,e){var n=m(t,e),r={id:n,time:e,method:t,count:y++};return v.push(r),n}function s(t){if(void 0!==t){w(t);var e=n(v,function(e){return e.id===t});v.splice(e,1)}}function c(){window.setTimeout=r,window.clearTimeout=i}function u(){window.setInterval=o,window.clearInterval=s}Object.defineProperty(e,"__esModule",{value:!0}),e.syncSetTimeout=r,e.syncClearTimeout=i,e.syncSetInterval=o,e.syncClearInterval=s,e.patchSetTimeout=c,e.patchSetInterval=u;var a=[],h=window.setTimeout,f=window.clearTimeout,l=0,d=-1,p=1;r.flush=function(){for(;a.length;){a.sort(function(t,e){return t.time===e.time?t.count<e.count?d:p:t.time<e.time?d:p});var t=a.shift();t.method(),clearInterval(t.id)}};var v=[],m=window.setInterval,w=window.clearInterval,y=0;o.cycle=function(){for(var t=v.length,e=0;t>e;e++){var n=v[e];n.method(),w(n.id),setInterval(n.method,n.time)}}},function(t,e){"use strict";function n(t){t.method=t.method||"GET","string"==typeof t.uri&&(t.uri=t.uri.replace(/\?/g,"\\?")),this.status=t.status||200,this.rawMethod=t.method.toString(),this.rawUri=t.uri.toString(),this.method=t.method instanceof RegExp?t.method:new RegExp(t.method,"i"),this.uri=t.uri instanceof RegExp?t.uri:new RegExp(t.uri,"i"),this.handler=t.handler,this.data=t.data,o.unshift(this)}function r(){this._requestHeaders={},this._eventHandlers={}}function i(){window.XMLHttpRequest=r}Object.defineProperty(e,"__esModule",{value:!0}),e.$mockEndpoint=n,e.SyncXMLHttpRequest=r,e.patchXmlHttpRequest=i;var o=[];n.prototype={enabled:!1,expect:!1,called:!1,listen:function(){return this.listening=!0,this.enable(),this},enable:function(){return this.enabled=!0,this},disable:function(){return this.enabled=!1,this.expect=!1,this},match:function(t,e){return Boolean(this.method.test(t)&&this.uri.test(e))},call:function(t,e){return this.called=!0,this.handler?this.handler(t,e):this.data},expectCalls:function(){return o.splice(o.indexOf(this),1),o.unshift(this),this.expect=!0,this.called=!1,this.enable(),this},done:function(){var t=this.expect&&!this.called;if(this.listening||this.disable(),this.expect=!1,this.called=!1,t)throw new Error("Expected call to "+this.rawMethod+" "+this.rawUri)}},n.register=function(t){return new n(t)},n.find=function(t,e){var n;return o.some(function(r){return r.match(t,e)&&r.enabled?n=r:void 0}),n},r.prototype={DONE:4,listen:function(){},open:function(t,e){var r=this;this.method=t,this.uri=e,this.mock=n.find(t,e),this.params={};var i=e.indexOf("?")>=0?e.substr(e.indexOf("?")+1).split("&"):[];if(i.forEach(function(t){var e=t.split("=");r.params[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}),!this.mock)throw new Error("Unexpected "+t.toUpperCase()+" "+e)},addEventListener:function(t,e){this._eventHandlers[t]=this._eventHandlers[t]||[],this._eventHandlers[t].push(e)},setRequestHeader:function(t,e){this._requestHeaders[t.toLowerCase()]=e},getResponseHeader:function(){},getAllResponseHeaders:function(){return"Content-Type: application/json"},send:function(t){var e=this;t&&"application/json"===this._requestHeaders["content-type"]&&(t=JSON.parse(t)),console.debug("REQUEST",this.method,this.uri,t);var n=this.mock.call(t,this.params);this._respond(this.mock.status,n);var r=void 0,i={get:function(){return r},set:function(t){r=t,e._respond(e.mock.status,n)}};Object.defineProperty(this,"onreadystatechange",i),Object.defineProperty(this,"onload",i)},_respond:function(t,e){if(!this._responded){if(this.status=t,this.response=this.responseText=JSON.stringify(e),this.readyState=4,this._eventHandlers.load){var n=!0,r=!1,i=void 0;try{for(var o,s=this._eventHandlers.load[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var c=o.value;c.call(this)}}catch(u){r=!0,i=u}finally{try{!n&&s["return"]&&s["return"]()}finally{if(r)throw i}}}var a=this.onreadystatechange||this.onload;a&&(this._responded=!0,console.debug("RESPONSE",t,JSON.stringify(e,0,2)),a.call(this))}}}}])});