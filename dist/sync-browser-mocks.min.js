!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("syncBrowserMocks",[],e):"object"==typeof exports?exports.syncBrowserMocks=e():t.syncBrowserMocks=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function i(){(0,r.patchPostMessage)(),(0,o.patchPromise)(),(0,s.patchSetTimeout)(),(0,s.patchSetInterval)(),(0,c.patchXmlHttpRequest)()}Object.defineProperty(e,"__esModule",{value:!0}),e.patchAll=i;var r=n(1);Object.keys(r).forEach(function(t){"default"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return r[t]}})});var o=n(2);Object.keys(o).forEach(function(t){"default"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return o[t]}})});var s=n(3);Object.keys(s).forEach(function(t){"default"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return s[t]}})});var c=n(4);Object.keys(c).forEach(function(t){"default"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return c[t]}})})},function(t,e){"use strict";function n(){}Object.defineProperty(e,"__esModule",{value:!0}),e.patchPostMessage=n},function(t,e){"use strict";function n(){window.Promise=i}Object.defineProperty(e,"__esModule",{value:!0}),e.patchPromise=n;var i=function(t){if(this.resolved=!1,this.rejected=!1,this.handlers=[],t){var e=this;t(function(t){e.resolve(t)},function(t){e.reject(t)})}};i.resolve=function(t){return(new i).resolve(t)},i.reject=function(t){return(new i).reject(t)},i.prototype.resolve=function(t){return this.resolved||this.rejected?this:(this.resolved=!0,this.value=t,this.dispatch(),this)},i.prototype.reject=function(t){return this.resolved||this.rejected?this:(this.rejected=!0,this.value=t,this.dispatch(),this)},i.prototype.dispatch=function(){if(this.resolved||this.rejected)for(;this.handlers.length;){var t,e,n=this.handlers.shift();try{t=this.resolved?n.onSuccess?n.onSuccess(this.value):this:n.onError?n.onError(this.value):this}catch(r){console.log(r.stack||r.toString()),e=r}e?n.promise.reject(e):t instanceof i?t.then(function(t){return n.promise.resolve(t)},function(t){return n.promise.reject(t)}):n.promise.resolve(t)}},i.prototype.then=function(t,e){var n=new i;return this.handlers.push({promise:n,onSuccess:t,onError:e}),this.dispatch(),n},i.prototype["catch"]=function(t){return this.then(null,t)}},function(t,e){"use strict";function n(t,e){if(t)for(var n=0;n<t.length;n++)if(e(t[n]))return n}function i(t,e){e=e||0;var n=h(function(){a.splice(a.indexOf(i),1),t()},e),i={id:n,time:e,method:t,count:f++};return a.push(i),n}function r(t){if(void 0!==t){d(t);var e=n(a,function(e){return e.id===t});a.splice(e,1)}}function o(t,e){var n=m(t,e),i={id:n,time:e,method:t,count:y++};return v.push(i),n}function s(t){if(void 0!==t){w(t);var e=n(v,function(e){return e.id===t});v.splice(e,1)}}function c(){window.setTimeout=i,window.clearTimeout=r}function u(){window.setInterval=o,window.clearInterval=s}Object.defineProperty(e,"__esModule",{value:!0}),e.patchSetTimeout=c,e.patchSetInterval=u;var a=[],h=window.setTimeout,d=window.clearTimeout,f=0,l=-1,p=1;i.flush=function(){for(;a.length;){a.sort(function(t,e){return t.time===e.time?t.count<e.count?l:p:t.time<e.time?l:p});var t=a.shift();t.method(),clearInterval(t.id)}};var v=[],m=window.setInterval,w=window.clearInterval,y=0;o.cycle=function(){for(var t=v.length,e=0;t>e;e++){var n=v[e];n.method(),w(n.id),setInterval(n.method,n.time)}}},function(t,e){"use strict";function n(t){t.method=t.method||"GET","string"==typeof t.uri&&(t.uri=t.uri.replace(/\?/g,"\\?")),this.status=t.status||200,this.rawMethod=t.method.toString(),this.rawUri=t.uri.toString(),this.method=t.method instanceof RegExp?t.method:new RegExp(t.method,"i"),this.uri=t.uri instanceof RegExp?t.uri:new RegExp(t.uri,"i"),this.handler=t.handler,this.data=t.data,r.unshift(this)}function i(){window.XMLHttpRequest=function(){},window.XMLHttpRequest.prototype={listen:function(){},open:function(t,e){var i=this;this.method=t,this.uri=e,this.mock=n.find(t,e),this.params={};var r=e.indexOf("?")>=0?e.substr(e.indexOf("?")+1).split("&"):[];if(r.forEach(function(t){var e=t.split("=");i.params[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}),!this.mock)throw new Error("Unexpected "+t.toUpperCase()+" "+e)},setRequestHeader:function(){},getResponseHeader:function(){},getAllResponseHeaders:function(){return"Content-Type: application/json"},send:function(t){var e=this;t&&(t=JSON.parse(t)),console.debug("REQUEST",this.method,this.uri,t);var n=this.mock.call(t,this.params);this._respond(this.mock.status,n);var i=void 0,r={get:function(){return i},set:function(t){i=t,e._respond(e.mock.status,n)}};Object.defineProperty(this,"onreadystatechange",r),Object.defineProperty(this,"onload",r)},_respond:function(t,e){if(!this._responded){var n=this.onreadystatechange||this.onload;n&&(this._responded=!0,console.debug("RESPONSE",t,JSON.stringify(e,0,2)),this.status=t,this.response=this.responseText=JSON.stringify(e),this.readyState=4,n.call(this))}}}}Object.defineProperty(e,"__esModule",{value:!0}),e.$mockEndpoint=n,e.patchXmlHttpRequest=i;var r=[];n.prototype={enabled:!1,expect:!1,called:!1,listen:function(){return this.listening=!0,this.enable(),this},enable:function(){return this.enabled=!0,this},disable:function(){return this.enabled=!1,this.expect=!1,this},match:function(t,e){return Boolean(this.method.test(t)&&this.uri.test(e))},call:function(t,e){return this.called=!0,this.handler?this.handler(t,e):this.data},expectCalls:function(){return r.splice(r.indexOf(this),1),r.unshift(this),this.expect=!0,this.called=!1,this.enable(),this},done:function(){var t=this.expect&&!this.called;if(this.listening||this.disable(),this.expect=!1,this.called=!1,t)throw new Error("Expected call to "+this.rawMethod+" "+this.rawUri)}},n.register=function(t){return new n(t)},n.find=function(t,e){var n;return r.some(function(i){return i.match(t,e)&&i.enabled?n=i:void 0}),n}}])});