!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("syncBrowserMocks",[],t):"object"==typeof exports?exports.syncBrowserMocks=t():e.syncBrowserMocks=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(){(0,o.patchSetTimeout)(),(0,o.patchSetInterval)(),(0,i.patchXmlHttpRequest)(),(0,a.patchWebSocket)()}Object.defineProperty(t,"__esModule",{value:!0}),t.patchAll=r;var o=n(1);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var i=n(2);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var s=n(3);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var a=n(4)},function(e,t){"use strict";function n(e,t){if(e)for(var n=0;n<e.length;n++)if(t(e[n]))return n}function r(e,t){t=t||0;var n=d(function(){u.splice(u.indexOf(r),1),e()},t),r={id:n,time:t,method:e,count:f++};return u.push(r),n}function o(e){if(void 0!==e){h(e);var t=n(u,function(t){return t.id===e});u.splice(t,1)}}function i(e,t){var n=m(e,t),r={id:n,time:t,method:e,count:b++};return v.push(r),n}function s(e){if(void 0!==e){y(e);var t=n(v,function(t){return t.id===e});v.splice(t,1)}}function a(){window.setTimeout=r,window.clearTimeout=o}function c(){window.setInterval=i,window.clearInterval=s}Object.defineProperty(t,"__esModule",{value:!0}),t.syncSetTimeout=r,t.syncClearTimeout=o,t.syncSetInterval=i,t.syncClearInterval=s,t.patchSetTimeout=a,t.patchSetInterval=c;var u=[],d=window.setTimeout,h=window.clearTimeout,f=0,l=-1,p=1;r.flush=function(){for(;u.length;){u.sort(function(e,t){return e.time===t.time?e.count<t.count?l:p:e.time<t.time?l:p});var e=u.shift();e.method(),clearInterval(e.id)}};var v=[],m=window.setInterval,y=window.clearInterval,b=0;i.cycle=function(){for(var e=v.length,t=0;t<e;t++){var n=v[t];n.method(),y(n.id),setInterval(n.method,n.time)}}},function(e,t){"use strict";function n(e){var t=this;e.method=e.method||"GET","string"==typeof e.uri&&(e.uri=e.uri.replace(/\?/g,"\\?")),this.status=e.status||200,this.rawMethod=e.method.toString(),this.rawUri=e.uri.toString(),this.method=e.method instanceof RegExp?e.method:new RegExp(e.method,"i"),this.uri=e.uri instanceof RegExp?e.uri:new RegExp(e.uri,"i"),this.handler=e.handler,this.data=e.data,e.headers?(this.headers={},Object.keys(e.headers).forEach(function(n){t.headers[n.toLowerCase()]=e.headers[n]})):this.headers={"content-type":"application/json"},i.unshift(this)}function r(){this._requestHeaders={},this._eventHandlers={}}function o(){window.XMLHttpRequest=r}Object.defineProperty(t,"__esModule",{value:!0}),t.$mockEndpoint=n,t.SyncXMLHttpRequest=r,t.patchXmlHttpRequest=o;var i=[];n.prototype={enabled:!1,expect:!1,called:!1,listeners:[],listen:function(){return this.listening=!0,this.enable(),this},enable:function(){return this.enabled=!0,this},disable:function(){return this.enabled=!1,this.expect=!1,this},match:function(e,t){return Boolean(this.method.test(e)&&this.uri.test(t))},call:function(e){return this.called=!0,this.listeners.forEach(function(e){return e()}),this.handler?this.handler(e):this.data},expectCalls:function(){return i.splice(i.indexOf(this),1),i.unshift(this),this.expect=!0,this.called=!1,this.enable(),this},onCall:function(e){this.listeners.push(e)},done:function(){var e=this.expect&&!this.called;if(this.listening||this.disable(),this.expect=!1,this.called=!1,e)throw new Error("Expected call to "+this.rawMethod+" "+this.rawUri)}},n.register=function(e){return new n(e)},n.find=function(e,t){var n;return i.some(function(r){if(r.match(e,t)&&r.enabled)return n=r}),n},r.prototype={DONE:4,listen:function(){},open:function(e,t){var r=this;this.method=e,this.uri=t,this.mock=n.find(e,t),this.query={};var o=t.indexOf("?")>=0?t.substr(t.indexOf("?")+1).split("&"):[];if(o.forEach(function(e){var t=e.split("=");r.query[decodeURIComponent(t[0])]=decodeURIComponent(t[1])}),!this.mock)throw new Error("Unexpected "+e.toUpperCase()+" "+t)},addEventListener:function(e,t){this._eventHandlers[e]=this._eventHandlers[e]||[],this._eventHandlers[e].push(t)},setRequestHeader:function(e,t){this._requestHeaders[e.toLowerCase()]=t},getResponseHeader:function(e){return this.mock.headers[e.toLowerCase()]},getAllResponseHeaders:function(){var e=this;return Object.keys(this.mock.headers).map(function(t){return t+": "+e.mock.headers[t]}).join("\n")},send:function(e){var t=this;e&&"application/json"===this._requestHeaders["content-type"]&&(e=JSON.parse(e)),console.debug("REQUEST",this.method,this.uri,e);var n=this.mock.call({data:e,query:this.query,headers:this._requestHeaders});this._respond(this.mock.status,n);var r=void 0,o={get:function(){return r},set:function(e){r=e,t._respond(t.mock.status,n)}};Object.defineProperty(this,"onreadystatechange",o),Object.defineProperty(this,"onload",o)},_respond:function(e,t){if(!this._responded){if(this.status=e,this.response=this.responseText=JSON.stringify(t),this.readyState=4,this._eventHandlers.load){var n=!0,r=!1,o=void 0;try{for(var i,s=this._eventHandlers.load[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var a=i.value;a.call(this)}}catch(e){r=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}}var c=this.onreadystatechange||this.onload;c&&(this._responded=!0,console.debug("RESPONSE",e,JSON.stringify(t,0,2)),c.call(this))}}}},function(e,t){"use strict";function n(e){var t=e.uri,n=e.handler,r=!1,o=!1,a={isListening:function(e){return r&&e===t},listen:function(){return r=!0,{cancel:function(){r=!1}}},receive:function(e){var t=e.data;o=!0,n({data:t,send:function(e){var t=!0,n=!1,r=void 0;try{for(var o,i=s[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;if(a.readyState===WebSocket.OPEN&&a.onmessage)return void a.onmessage({data:e})}}catch(e){n=!0,r=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw r}}}})},expect:function(){return r=!0,{done:function(){if(r=!1,!o)throw new Error("Expected websocket calls")}}}};return i.push(a),a}function r(e){var t={readyState:WebSocket.OPEN,send:function(n){if(t.readyState!==WebSocket.OPEN)throw new Error("Socket is closed");for(var r=i.length-1;r>=0;r--){var o=i[r];if(o.isListening(e))return void o.receive({data:n})}},close:function(){t.readyState=WebSocket.CLOSED,t.onclose&&t.onclose()}};return s.push(t),setTimeout(function(){t.onopen&&t.onopen()}),t}function o(){window.WebSocket=r}Object.defineProperty(t,"__esModule",{value:!0}),t.mockWebSocket=n,t.patchWebSocket=o;var i=(window.WebSocket,[]),s=[];r.OPEN=WebSocket.OPEN,r.CLOSED=WebSocket.CLOSED},function(e,t){"use strict";function n(e){var t=e.uri,n=e.handler,r=!1,o=!1,a={isListening:function(e){return r&&e===t},listen:function(){return r=!0,{cancel:function(){r=!1}}},receive:function(e){var t=e.data;o=!0,n({data:t,send:function(e){var t=!0,n=!1,r=void 0;try{for(var o,i=s[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;if(a.readyState===WebSocket.OPEN&&a.onmessage)return void a.onmessage({data:e})}}catch(e){n=!0,r=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw r}}}})},expect:function(){return r=!0,{done:function(){if(r=!1,!o)throw new Error("Expected websocket calls")}}}};return i.push(a),a}function r(e){var t={readyState:WebSocket.OPEN,send:function(n){if(t.readyState!==WebSocket.OPEN)throw new Error("Socket is closed");for(var r=i.length-1;r>=0;r--){var o=i[r];if(o.isListening(e))return void o.receive({data:n})}},close:function(){t.readyState=WebSocket.CLOSED,t.onclose&&t.onclose()}};return s.push(t),setTimeout(function(){t.onopen&&t.onopen()}),t}function o(){window.WebSocket=r}Object.defineProperty(t,"__esModule",{value:!0}),t.mockWebSocket=n,t.patchWebSocket=o;var i=(window.WebSocket,[]),s=[];r.OPEN=WebSocket.OPEN,r.CLOSED=WebSocket.CLOSED}])});