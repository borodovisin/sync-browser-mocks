!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("syncBrowserMocks",[],t):"object"==typeof exports?exports.syncBrowserMocks=t():e.syncBrowserMocks=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(){(0,o.patchSetTimeout)(),(0,o.patchSetInterval)(),(0,i.patchXmlHttpRequest)(),(0,c.patchWebSocket)()}Object.defineProperty(t,"__esModule",{value:!0}),t.patchAll=r;var o=n(1);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var i=n(2);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var s=n(5);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var c=n(6)},function(e,t){"use strict";function n(e,t){if(e)for(var n=0;n<e.length;n++)if(t(e[n]))return n}function r(e,t){t=t||0;var n=l(function(){a.splice(a.indexOf(r),1),e()},t),r={id:n,time:t,method:e,count:d++};return a.push(r),n}function o(e){if(void 0!==e){f(e);var t=n(a,function(t){return t.id===e});a.splice(t,1)}}function i(e,t){var n=y(e,t),r={id:n,time:t,method:e,count:m++};return v.push(r),n}function s(e){if(void 0!==e){b(e);var t=n(v,function(t){return t.id===e});v.splice(t,1)}}function c(){window.setTimeout=r,window.clearTimeout=o}function u(){window.setInterval=i,window.clearInterval=s}Object.defineProperty(t,"__esModule",{value:!0}),t.syncSetTimeout=r,t.syncClearTimeout=o,t.syncSetInterval=i,t.syncClearInterval=s,t.patchSetTimeout=c,t.patchSetInterval=u;var a=[],l=window.setTimeout,f=window.clearTimeout,d=0,h=-1,p=1;r.flush=function(){for(;a.length;){a.sort(function(e,t){return e.time===t.time?e.count<t.count?h:p:e.time<t.time?h:p});var e=a.shift();e.method(),clearInterval(e.id)}};var v=[],y=window.setInterval,b=window.clearInterval,m=0;i.cycle=function(){for(var e=v.length,t=0;t<e;t++){var n=v[t];n.method(),b(n.id),setInterval(n.method,n.time)}}},function(e,t,n){"use strict";function r(e){var t=this;e.method=e.method||"GET","string"==typeof e.uri&&(e.uri=e.uri.replace(/\?/g,"\\?")),this.status=e.status||200,this.rawMethod=e.method.toString(),this.rawUri=e.uri.toString(),this.method=e.method instanceof RegExp?e.method:new RegExp(e.method,"i"),this.uri=e.uri instanceof RegExp?e.uri:new RegExp(e.uri,"i"),this.handler=e.handler,this.data=e.data,e.headers?(this.headers={},Object.keys(e.headers).forEach(function(n){t.headers[n.toLowerCase()]=e.headers[n]})):this.headers={"content-type":"application/json"},c.unshift(this)}function o(){this._requestHeaders={},this._eventHandlers={}}function i(){window.XMLHttpRequest=o}Object.defineProperty(t,"__esModule",{value:!0}),t.$mockEndpoint=r,t.SyncXMLHttpRequest=o,t.patchXmlHttpRequest=i;var s=n(3),c=[];r.prototype={enabled:!1,expect:!1,called:!1,listeners:[],listen:function(){return this.listening=!0,this.enable(),this},enable:function(){return this.enabled=!0,this},disable:function(){return this.enabled=!1,this.expect=!1,this},match:function(e,t){return Boolean(this.method.test(e)&&this.uri.test(t))},call:function(e){return this.called=!0,this.listeners.forEach(function(e){return e()}),this.handler?this.handler(e):this.data},expectCalls:function(){return c.splice(c.indexOf(this),1),c.unshift(this),this.expect=!0,this.called=!1,this.enable(),this},onCall:function(e){this.listeners.push(e)},done:function(){var e=this.expect&&!this.called;if(this.listening||this.disable(),this.expect=!1,this.called=!1,e)throw new Error("Expected call to "+this.rawMethod+" "+this.rawUri)}},r.register=function(e){return new r(e)},r.find=function(e,t){var n;return c.some(function(r){if(r.match(e,t)&&r.enabled)return n=r}),n},o.prototype={DONE:4,listen:function(){},open:function(e,t){var n=this;this.method=e,this.uri=t,this.mock=r.find(e,t),this.query={};var o=t.indexOf("?")>=0?t.substr(t.indexOf("?")+1).split("&"):[];if(o.forEach(function(e){var t=e.split("=");n.query[decodeURIComponent(t[0])]=decodeURIComponent(t[1])}),!this.mock)throw new Error("Unexpected "+e.toUpperCase()+" "+t)},addEventListener:function(e,t){this._eventHandlers[e]=this._eventHandlers[e]||[],this._eventHandlers[e].push(t)},setRequestHeader:function(e,t){this._requestHeaders[e.toLowerCase()]=t},getResponseHeader:function(e){return this.mock.headers[e.toLowerCase()]},getAllResponseHeaders:function(){var e=this;return Object.keys(this.mock.headers).map(function(t){return t+": "+e.mock.headers[t]}).join("\n")},send:function(e){var t=this;e&&"application/json"===this._requestHeaders["content-type"]&&(e=JSON.parse(e)),console.debug("REQUEST",this.method,this.uri,e),s.ZalgoPromise.try(function(){return t.mock.call({data:e,query:t.query,headers:t._requestHeaders})}).then(function(e){return{response:e,status:t.mock.status}}).catch(function(e){return{response:e.stack||e.toString,status:500}}).then(function(e){var n=e.response,r=e.status;t._respond(r,n);var o=void 0,i={get:function(){return o},set:function(e){o=e,t._respond(t.mock.status,n)}};Object.defineProperty(t,"onreadystatechange",i),Object.defineProperty(t,"onload",i)})},_respond:function(e,t){if(!this._responded){if(this.status=e,this.response=this.responseText=JSON.stringify(t),this.readyState=4,this._eventHandlers.load){var n=!0,r=!1,o=void 0;try{for(var i,s=this._eventHandlers.load[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c=i.value;c.call(this)}}catch(e){r=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}}var u=this.onreadystatechange||this.onload;u&&(this._responded=!0,console.debug("RESPONSE",e,JSON.stringify(t,0,2)),u.call(this))}}}},function(e,t,n){e.exports=n(4)},function(e,t,n){!function(t,n){e.exports=n()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s="./src/export.js")}({"./node_modules/webpack/buildin/global.js":function(e,t,n){"use strict";var r,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"===("undefined"==typeof window?"undefined":o(window))&&(r=window)}e.exports=r},"./src/exceptions.js":function(e,t,n){"use strict";function r(e){if(-1===(0,i.getGlobal)().dispatchedErrors.indexOf(e)){(0,i.getGlobal)().dispatchedErrors.push(e),setTimeout(function(){throw e},1);for(var t=0;t<(0,i.getGlobal)().possiblyUnhandledPromiseHandlers.length;t++)(0,i.getGlobal)().possiblyUnhandledPromiseHandlers[t](e)}}function o(e){return(0,i.getGlobal)().possiblyUnhandledPromiseHandlers.push(e),{cancel:function(){(0,i.getGlobal)().possiblyUnhandledPromiseHandlers.splice((0,i.getGlobal)().possiblyUnhandledPromiseHandlers.indexOf(e),1)}}}Object.defineProperty(t,"__esModule",{value:!0}),t.dispatchPossiblyUnhandledError=r,t.onPossiblyUnhandledException=o;var i=n("./src/global.js")},"./src/export.js":function(e,t,n){"use strict";e.exports=n("./src/promise.js").ZalgoPromise,e.exports.ZalgoPromise=n("./src/promise.js").ZalgoPromise},"./src/global.js":function(e,t,n){"use strict";(function(e){function n(){var t=void 0;if("undefined"!=typeof window)t=window;else{if(void 0===e)throw new Error("Can not find global");t=e}var n=t.__zalgopromise__=t.__zalgopromise__||{};return n.flushPromises=n.flushPromises||[],n.activeCount=n.activeCount||0,n.possiblyUnhandledPromiseHandlers=n.possiblyUnhandledPromiseHandlers||[],n.dispatchedErrors=n.dispatchedErrors||[],n}Object.defineProperty(t,"__esModule",{value:!0}),t.getGlobal=n}).call(t,n("./node_modules/webpack/buildin/global.js"))},"./src/promise.js":function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.ZalgoPromise=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n("./src/utils.js"),s=n("./src/exceptions.js"),c=n("./src/global.js"),u=function(){function e(t){var n=this;if(r(this,e),this.resolved=!1,this.rejected=!1,this.errorHandled=!1,this.handlers=[],t){var o=void 0,i=void 0,s=!1,c=!1,u=!1;try{t(function(e){u?n.resolve(e):(s=!0,o=e)},function(e){u?n.reject(e):(c=!0,i=e)})}catch(e){return void this.reject(e)}u=!0,s?this.resolve(o):c&&this.reject(i)}}return o(e,[{key:"resolve",value:function(e){if(this.resolved||this.rejected)return this;if((0,i.isPromise)(e))throw new Error("Can not resolve promise with another promise");return this.resolved=!0,this.value=e,this.dispatch(),this}},{key:"reject",value:function(e){var t=this;if(this.resolved||this.rejected)return this;if((0,i.isPromise)(e))throw new Error("Can not reject promise with another promise");if(!e){var n=e&&"function"==typeof e.toString?e.toString():Object.prototype.toString.call(e);e=new Error("Expected reject to be called with Error, got "+n)}return this.rejected=!0,this.error=e,this.errorHandled||setTimeout(function(){t.errorHandled||(0,s.dispatchPossiblyUnhandledError)(e)},1),this.dispatch(),this}},{key:"asyncReject",value:function(e){this.errorHandled=!0,this.reject(e)}},{key:"dispatch",value:function(){var t=this,n=this.dispatching,r=this.resolved,o=this.rejected,s=this.handlers;if(!n&&(r||o)){this.dispatching=!0,(0,c.getGlobal)().activeCount+=1;for(var u=0;u<s.length;u++)!function(n){var c=s[n],u=c.onSuccess,a=c.onError,l=c.promise,f=void 0;if(r)try{f=u?u(t.value):t.value}catch(e){return l.reject(e),"continue"}else if(o){if(!a)return l.reject(t.error),"continue";try{f=a(t.error)}catch(e){return l.reject(e),"continue"}}f instanceof e&&(f.resolved||f.rejected)?(f.resolved?l.resolve(f.value):l.reject(f.error),f.errorHandled=!0):(0,i.isPromise)(f)?f instanceof e&&(f.resolved||f.rejected)?f.resolved?l.resolve(f.value):l.reject(f.error):f.then(function(e){l.resolve(e)},function(e){l.reject(e)}):l.resolve(f)}(u);s.length=0,this.dispatching=!1,(0,c.getGlobal)().activeCount-=1,0===(0,c.getGlobal)().activeCount&&e.flushQueue()}}},{key:"then",value:function(t,n){if(t&&"function"!=typeof t&&!t.call)throw new Error("Promise.then expected a function for success handler");if(n&&"function"!=typeof n&&!n.call)throw new Error("Promise.then expected a function for error handler");var r=new e;return this.handlers.push({promise:r,onSuccess:t,onError:n}),this.errorHandled=!0,this.dispatch(),r}},{key:"catch",value:function(e){return this.then(void 0,e)}},{key:"finally",value:function(t){return this.then(function(n){return e.try(t).then(function(){return n})},function(n){return e.try(t).then(function(){throw n})})}},{key:"timeout",value:function(e,t){var n=this;if(this.resolved||this.rejected)return this;var r=setTimeout(function(){n.resolved||n.rejected||n.reject(t||new Error("Promise timed out after "+e+"ms"))},e);return this.then(function(e){return clearTimeout(r),e})}},{key:"toPromise",value:function(){if("undefined"==typeof Promise)throw new Error("Could not find Promise");return Promise.resolve(this)}}],[{key:"resolve",value:function(t){return t instanceof e?t:(0,i.isPromise)(t)?new e(function(e,n){return t.then(e,n)}):(new e).resolve(t)}},{key:"reject",value:function(t){return(new e).reject(t)}},{key:"all",value:function(t){var n=new e,r=t.length,o=[];if(!r)return n.resolve(o),n;for(var s=0;s<t.length;s++)!function(s){var c=t[s];if(c instanceof e){if(c.resolved)return o[s]=c.value,r-=1,"continue"}else if(!(0,i.isPromise)(c))return o[s]=c,r-=1,"continue";e.resolve(c).then(function(e){o[s]=e,r-=1,0===r&&n.resolve(o)},function(e){n.reject(e)})}(s);return 0===r&&n.resolve(o),n}},{key:"hash",value:function(t){var n={};return e.all(Object.keys(t).map(function(r){return e.resolve(t[r]).then(function(e){n[r]=e})})).then(function(){return n})}},{key:"map",value:function(t,n){return e.all(t.map(n))}},{key:"onPossiblyUnhandledException",value:function(e){return(0,s.onPossiblyUnhandledException)(e)}},{key:"try",value:function(t,n,r){var o=void 0;try{o=t.apply(n,r||[])}catch(t){return e.reject(t)}return e.resolve(o)}},{key:"delay",value:function(t){return new e(function(e){setTimeout(e,t)})}},{key:"isPromise",value:function(t){return!!(t&&t instanceof e)||(0,i.isPromise)(t)}},{key:"flush",value:function(){var t=new e;return(0,c.getGlobal)().flushPromises.push(t),0===(0,c.getGlobal)().activeCount&&e.flushQueue(),t}},{key:"flushQueue",value:function(){var e=(0,c.getGlobal)().flushPromises;(0,c.getGlobal)().flushPromises=[];for(var t=e,n=Array.isArray(t),r=0,t=n?t:t[Symbol.iterator]();;){var o;if(n){if(r>=t.length)break;o=t[r++]}else{if(r=t.next(),r.done)break;o=r.value}o.resolve()}}}]),e}();t.ZalgoPromise=u},"./src/utils.js":function(e,t,n){"use strict";function r(e){try{if(!e)return!1;if("undefined"!=typeof Promise&&e instanceof Promise)return!0;if("undefined"!=typeof window&&window.Window&&e instanceof window.Window)return!1;if("undefined"!=typeof window&&window.constructor&&e instanceof window.constructor)return!1;var t={}.toString;if(t){var n=t.call(e);if("[object Window]"===n||"[object global]"===n||"[object DOMWindow]"===n)return!1}if("function"==typeof e.then)return!0}catch(e){return!1}return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.isPromise=r}})})},function(e,t){"use strict";function n(e){var t=e.uri,n=e.handler,r=!1,o=!1,c={isListening:function(e){return r&&e===t},listen:function(){return r=!0,{cancel:function(){r=!1}}},receive:function(e){var t=e.data;o=!0,n({data:t,respond:function(e){return c.send(e)}})},send:function(e){var t=!0,n=!1,r=void 0;try{for(var o,i=s[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var c=o.value;if(c.readyState===WebSocket.OPEN&&c.onmessage)return void c.onmessage({data:e})}}catch(e){n=!0,r=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw r}}},expect:function(){return r=!0,{done:function(){if(r=!1,!o)throw new Error("Expected websocket calls")}}}};return i.push(c),c}function r(e){var t=function(){for(var t=i.length-1;t>=0;t--){var n=i[t];if(n.isListening(e))return n}},n={readyState:WebSocket.OPEN,send:function(e){if(n.readyState!==WebSocket.OPEN)throw new Error("Socket is closed");var r=t();if(r)return void r.receive({data:e})},close:function(){n.readyState=WebSocket.CLOSED,n.onclose&&n.onclose()},get onopen(){return n._onopen},set onopen(e){n._onopen=e,t()&&n._onopen()},get onerror(){return n._onerror},set onerror(e){n._onerror=e,t()||n._onerror(new Error("No socket server found"))},get onclose(){return n._onclose},set onclose(e){n._onclose=e,t()||n._onclose()}};return s.push(n),n}function o(){window.WebSocket=r}Object.defineProperty(t,"__esModule",{value:!0}),t.mockWebSocket=n,t.patchWebSocket=o;var i=[],s=[];r.OPEN=WebSocket.OPEN,r.CLOSED=WebSocket.CLOSED},function(e,t){"use strict";function n(e){var t=e.uri,n=e.handler,r=!1,o=!1,c={isListening:function(e){return r&&e===t},listen:function(){return r=!0,{cancel:function(){r=!1}}},receive:function(e){var t=e.data;o=!0,n({data:t,respond:function(e){return c.send(e)}})},send:function(e){var t=!0,n=!1,r=void 0;try{for(var o,i=s[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var c=o.value;if(c.readyState===WebSocket.OPEN&&c.onmessage)return void c.onmessage({data:e})}}catch(e){n=!0,r=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw r}}},expect:function(){return r=!0,{done:function(){if(r=!1,!o)throw new Error("Expected websocket calls")}}}};return i.push(c),c}function r(e){var t=function(){for(var t=i.length-1;t>=0;t--){var n=i[t];if(n.isListening(e))return n}},n={readyState:WebSocket.OPEN,send:function(e){if(n.readyState!==WebSocket.OPEN)throw new Error("Socket is closed");var r=t();if(r)return void r.receive({data:e})},close:function(){n.readyState=WebSocket.CLOSED,n.onclose&&n.onclose()},get onopen(){return n._onopen},set onopen(e){n._onopen=e,t()&&n._onopen()},get onerror(){return n._onerror},set onerror(e){n._onerror=e,t()||n._onerror(new Error("No socket server found"))},get onclose(){return n._onclose},set onclose(e){n._onclose=e,t()||n._onclose()}};return s.push(n),n}function o(){window.WebSocket=r}Object.defineProperty(t,"__esModule",{value:!0}),t.mockWebSocket=n,t.patchWebSocket=o;var i=[],s=[];r.OPEN=WebSocket.OPEN,r.CLOSED=WebSocket.CLOSED}])});