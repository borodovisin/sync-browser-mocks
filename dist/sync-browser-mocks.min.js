!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("syncBrowserMocks",[],t):"object"==typeof exports?exports.syncBrowserMocks=t():e.syncBrowserMocks=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(){(0,i.patchPostMessage)(),(0,o.patchPromise)(),(0,s.patchSetTimeout)(),(0,s.patchSetInterval)(),(0,c.patchXmlHttpRequest)()}Object.defineProperty(t,"__esModule",{value:!0}),t.patchAll=r;var i=n(1);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var o=n(2);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var s=n(3);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var c=n(4);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})})},function(e,t){"use strict";function n(){}Object.defineProperty(t,"__esModule",{value:!0}),t.patchPostMessage=n},function(e,t){"use strict";function n(e,t,n){function r(){if(i){if(s)return n(c);if(o)return t(u)}}var i=!1,o=!1,s=!1,c=void 0,u=void 0;try{e(function(e){u=e,o=!0,r()},function(e){c=e,s=!0,r()})}catch(e){return n(e)}i=!0,r()}function r(e){a.push(e),h=h||setTimeout(i,1)}function i(){h=null;var e=a;a=[];for(var t=function(t){var n=e[t];return n.silentReject?"continue":(n.handlers.push({onError:function(e){n.silentReject||o(e)}}),void n.dispatch())},n=0;n<e.length;n++){t(n)}}function o(e){if(f.indexOf(e)===-1){f.push(e),setTimeout(function(){throw e},1);for(var t=0;t<u.length;t++)u[t](e)}}function s(e){try{if(!e)return!1;if(window.Window&&e instanceof window.Window)return!1;if(window.constructor&&e instanceof window.constructor)return!1;if(l){var t=l.call(e);if("[object Window]"===t||"[object global]"===t||"[object DOMWindow]"===t)return!1}if(e&&e.then instanceof Function)return!0}catch(e){return!1}return!1}function c(){window.Promise=d}Object.defineProperty(t,"__esModule",{value:!0}),t.patchPromise=c;var u=[],a=[],h=void 0,f=[],l={}.toString,d=t.SyncPromise=function(e){if(this.resolved=!1,this.rejected=!1,this.silentReject=!1,this.handlers=[],r(this),e){var t=this;n(e,function(e){return t.resolve(e)},function(e){return t.reject(e)})}};d.resolve=function(e){return s(e)?e:(new d).resolve(e)},d.reject=function(e){return(new d).reject(e)},d.prototype.resolve=function(e){if(this.resolved||this.rejected)return this;if(s(e))throw new Error("Can not resolve promise with another promise");return this.resolved=!0,this.value=e,this.dispatch(),this},d.prototype.reject=function(e){if(this.resolved||this.rejected)return this;if(s(e))throw new Error("Can not reject promise with another promise");return e||(e=new Error("Expected reject to be called with Error, got "+e)),this.rejected=!0,this.value=e,this.dispatch(),this},d.prototype.asyncReject=function(e){this.silentReject=!0,this.reject(e)},d.prototype.dispatch=function(){var e=this;if(this.resolved||this.rejected)for(var t=function(){var t=e.handlers.shift(),n=!1,r=void 0,i=void 0;try{e.resolved?r=t.onSuccess?t.onSuccess(e.value):e.value:e.rejected&&(t.onError?r=t.onError(e.value):(n=!0,i=e.value))}catch(e){n=!0,i=e}if(r===e)throw new Error("Can not return a promise from the the then handler of the same promise");return t.promise?void(n?t.promise.reject(i):s(r)?r.then(function(e){t.promise.resolve(e)},function(e){t.promise.reject(e)}):t.promise.resolve(r)):"continue"};this.handlers.length;){t()}},d.prototype.then=function(e,t){if(e&&"function"!=typeof e&&!e.call)throw new Error("Promise.then expected a function for success handler");if(t&&"function"!=typeof t&&!t.call)throw new Error("Promise.then expected a function for error handler");var n=new d(null,this);return this.handlers.push({promise:n,onSuccess:e,onError:t}),this.silentReject=!0,this.dispatch(),n},d.prototype.catch=function(e){return this.then(null,e)},d.prototype.finally=function(e){return this.then(function(t){return d.try(e).then(function(){return t})},function(t){return d.try(e).then(function(){throw t})})},d.all=function(e){for(var t=new d,n=e.length,r=[],i=function(i){var o=s(e[i])?e[i]:d.resolve(e[i]);o.then(function(e){r[i]=e,n-=1,0===n&&t.resolve(r)},function(e){t.reject(e)})},o=0;o<e.length;o++)i(o);return n||t.resolve(r),t},d.onPossiblyUnhandledException=function(e){u.push(e)},d.try=function(e){return d.resolve().then(e)},d.delay=function(e){return new d(function(t){setTimeout(t,e)})},d.hash=function(e){var t={},n=[],r=function(r){e.hasOwnProperty(r)&&n.push(d.resolve(e[r]).then(function(e){t[r]=e}))};for(var i in e)r(i);return d.all(n).then(function(){return t})},d.promisifyCall=function(){var e=Array.prototype.slice.call(arguments),t=e.shift();if("function"!=typeof t)throw new Error("Expected promisifyCall to be called with a function");return new d(function(n,r){return e.push(function(e,t){return e?r(e):n(t)}),t.apply(null,e)})}},function(e,t){"use strict";function n(e,t){if(e)for(var n=0;n<e.length;n++)if(t(e[n]))return n}function r(e,t){t=t||0;var n=h(function(){a.splice(a.indexOf(r),1),e()},t),r={id:n,time:t,method:e,count:l++};return a.push(r),n}function i(e){if(void 0!==e){f(e);var t=n(a,function(t){return t.id===e});a.splice(t,1)}}function o(e,t){var n=m(e,t),r={id:n,time:t,method:e,count:y++};return v.push(r),n}function s(e){if(void 0!==e){w(e);var t=n(v,function(t){return t.id===e});v.splice(t,1)}}function c(){window.setTimeout=r,window.clearTimeout=i}function u(){window.setInterval=o,window.clearInterval=s}Object.defineProperty(t,"__esModule",{value:!0}),t.syncSetTimeout=r,t.syncClearTimeout=i,t.syncSetInterval=o,t.syncClearInterval=s,t.patchSetTimeout=c,t.patchSetInterval=u;var a=[],h=window.setTimeout,f=window.clearTimeout,l=0,d=-1,p=1;r.flush=function(){for(;a.length;){a.sort(function(e,t){return e.time===t.time?e.count<t.count?d:p:e.time<t.time?d:p});var e=a.shift();e.method(),clearInterval(e.id)}};var v=[],m=window.setInterval,w=window.clearInterval,y=0;o.cycle=function(){for(var e=v.length,t=0;t<e;t++){var n=v[t];n.method(),w(n.id),setInterval(n.method,n.time)}}},function(e,t){"use strict";function n(e){var t=this;e.method=e.method||"GET","string"==typeof e.uri&&(e.uri=e.uri.replace(/\?/g,"\\?")),this.status=e.status||200,this.rawMethod=e.method.toString(),this.rawUri=e.uri.toString(),this.method=e.method instanceof RegExp?e.method:new RegExp(e.method,"i"),this.uri=e.uri instanceof RegExp?e.uri:new RegExp(e.uri,"i"),this.handler=e.handler,this.data=e.data,e.headers?(this.headers={},Object.keys(e.headers).forEach(function(n){t.headers[n.toLowerCase()]=e.headers[n]})):this.headers={"content-type":"application/json"},o.unshift(this)}function r(){this._requestHeaders={},this._eventHandlers={}}function i(){window.XMLHttpRequest=r}Object.defineProperty(t,"__esModule",{value:!0}),t.$mockEndpoint=n,t.SyncXMLHttpRequest=r,t.patchXmlHttpRequest=i;var o=[];n.prototype={enabled:!1,expect:!1,called:!1,listen:function(){return this.listening=!0,this.enable(),this},enable:function(){return this.enabled=!0,this},disable:function(){return this.enabled=!1,this.expect=!1,this},match:function(e,t){return Boolean(this.method.test(e)&&this.uri.test(t))},call:function(e){return this.called=!0,this.handler?this.handler(e):this.data},expectCalls:function(){return o.splice(o.indexOf(this),1),o.unshift(this),this.expect=!0,this.called=!1,this.enable(),this},done:function(){var e=this.expect&&!this.called;if(this.listening||this.disable(),this.expect=!1,this.called=!1,e)throw new Error("Expected call to "+this.rawMethod+" "+this.rawUri)}},n.register=function(e){return new n(e)},n.find=function(e,t){var n;return o.some(function(r){if(r.match(e,t)&&r.enabled)return n=r}),n},r.prototype={DONE:4,listen:function(){},open:function(e,t){var r=this;this.method=e,this.uri=t,this.mock=n.find(e,t),this.query={};var i=t.indexOf("?")>=0?t.substr(t.indexOf("?")+1).split("&"):[];if(i.forEach(function(e){var t=e.split("=");r.query[decodeURIComponent(t[0])]=decodeURIComponent(t[1])}),!this.mock)throw new Error("Unexpected "+e.toUpperCase()+" "+t)},addEventListener:function(e,t){this._eventHandlers[e]=this._eventHandlers[e]||[],this._eventHandlers[e].push(t)},setRequestHeader:function(e,t){this._requestHeaders[e.toLowerCase()]=t},getResponseHeader:function(e){return this.mock.headers[e.toLowerCase()]},getAllResponseHeaders:function(){var e=this;return Object.keys(this.mock.headers).map(function(t){return t+": "+e.mock.headers[t]}).join("\n")},send:function(e){var t=this;e&&"application/json"===this._requestHeaders["content-type"]&&(e=JSON.parse(e)),console.debug("REQUEST",this.method,this.uri,e);var n=this.mock.call({data:e,query:this.query,headers:this._requestHeaders});this._respond(this.mock.status,n);var r=void 0,i={get:function(){return r},set:function(e){r=e,t._respond(t.mock.status,n)}};Object.defineProperty(this,"onreadystatechange",i),Object.defineProperty(this,"onload",i)},_respond:function(e,t){if(!this._responded){if(this.status=e,this.response=this.responseText=JSON.stringify(t),this.readyState=4,this._eventHandlers.load){var n=!0,r=!1,i=void 0;try{for(var o,s=this._eventHandlers.load[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var c=o.value;c.call(this)}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}}var u=this.onreadystatechange||this.onload;u&&(this._responded=!0,console.debug("RESPONSE",e,JSON.stringify(t,0,2)),u.call(this))}}}}])});